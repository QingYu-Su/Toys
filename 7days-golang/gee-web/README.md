# 项目说明

项目教学地址：[7天用Go从零实现Web框架Gee教程](https://geektutu.com/post/gee.html)

## 第1天

1. 建立路由映射表，key由请求方法和静态路由地址构成，如`GET-/、GET-/hello、POST-/hello`，value 是用户映射的处理方法
2. 用户可以使用GET、POST等方法添加不同处理，每个处理都接受同样的输入参数，即Request和Response，由用户自己处理该怎么运行
3. Run方法是ListenAndServe的包装，只要类实现了ServeHTTP接口，即可处理ListenAndServe
4. ServeHTTP方法的作用就是，解析请求的路径，查找路由映射表，如果查到，就执行注册的处理方法。如果查不到，就返回404 NOT FOUND 。

## 第2天
1. 使用Context来封装Request和Response ，提供对JSON、HTML等返回类型的支持，用户可以更方便地去使用
2. 将路由相关的方法，比如添加路由给独立出来，作为独立的类，方便后续设计动态路由

## 第3天
1. 构建前缀树，以满足动态路由。前缀树的根节点为`/`。
2. 前缀树与路由高度耦合，路由根据方法类型不同（Get、Post）来构造不同的前缀树，并且根据每个路由映射处理方法。
3. 前缀树和路由都必须实现插入和搜索操作，插入时的逻辑与搜索路径有点不一样，主要还是在于其通配符的存在

## 第4天
1. 设计分组，分组由相同的路由前缀决定
2. 分组和e框架核心类高度耦合，位于路由和前缀树的上层，只负责分组，不负责底层的路由映射
3. 分组支持嵌套和中间件，父分组的中间件应该可以应用在所有子分组上


## 第5天
1. 设计中间件，可以在用户处理函数的前后，加入不同的处理方法。
2. 中间件设计在分组和Context上，每个分组都有其中间件，而Context根据其路径匹配规则，获取所有分组的中间件。
3. 由于分组必然是先有父分组再有子分组，因此中间件采用切片存储，这种方式保证了其顺序为父分组——子分组
4. 在匹配到对应的用户处理函数后，也将其作为中间件添加，并且此时为最后的中间件。
5. 我们依然可以在用户处理后，接着处理其他中间件，关键就在于Context.next函数会依次处理所有函数，然后在返回。这样我们可以在中间件的中间去调用他，然后在处理完所有中间件后，再做额外处理。

## 第6天
1. 设计静态文件映射，即url映射到服务器的文件路径上
2. 利用Go的HTML模板引擎，设计几个包装函数，包括模板加载，模板函数设置等。

## 第7天
1. 添加错误处理机制，用来处理panic
2. panic是一种严重错误，会不断回溯函数调用堆栈中，每个函数的defer（包括触发panic所在行的函数）
3. 如果遇到defer中有recover的，则会被捕获，然后被处理，之后回溯上一层，继续向下执行
4. 将错误处理机制作为默认中间件，与日志一起，首先设置日志，然后设置错误处理，这样后续中间件出错，也会在错误处理这块打印出堆栈，然后回到日志处理模块，打印出处理时间，不会导致服务死掉。